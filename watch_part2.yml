#!/usr/bin/env ansible-playbook

- hosts: localhost
  become: no

  tasks:
    - fail: msg="ansible version is {{ ansible_version['full'] }}, requires >= 2.1"
      when: ansible_version['full'] | version_compare('2.1', '<')
      tags:
        - always
        - ansible-version

- hosts: apache
  become: yes

  vars_prompt:
    - name: "users"
      prompt: "Enter one or more UWNetIds. Use space to separate"
      private: no

  tasks:
    - name: checking apache
      script: scripts/check_apache.sh "{{ users }}"
      register: apache_result

    - debug: msg="{{ apache_result.stdout }}"

    - local_action: blockinfile \
        block="{{ apache_result.stdout }}" \
        path="/tmp/watch_results.txt" \
        create=yes \
        marker=""

- hosts: tracker
  become: yes

  vars_prompt:
    - name: "users"
      prompt: "Enter one or more UWNetIds. Use space to separate"
      private: no

  tasks:
    - name: checking tracker
      script: scripts/check_tracker.sh "{{ users }}"
      register: tracker_result

    - debug: msg="{{ tracker_result.stdout }}"

    - local_action: blockinfile \
        block="{{ tracker_result.stdout }}" \
        path="/tmp/watch_results.txt"  \
        marker=""
